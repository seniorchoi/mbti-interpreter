<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}MBTI Oracle{% endblock %}</title>
    <!-- Meta Tags and CSS Links -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/litera/bootstrap.min.css"
    />
    <!-- Font Awesome -->
    <link
        rel="stylesheet"
        href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
    >
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto&display=swap"
        rel="stylesheet"
    >
    <!-- Custom CSS -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon2.png') }}" type="image/x-icon">
    <!-- Mixpanel Library -->
    <script type="text/javascript">
    (function (e, a) {
        if (!a.__SV) {
        var b = window;
        try {
            var c, l, i, j = b.location, g = j.hash;
            c = function (a, b) {
            return (l = a.match(RegExp(b + "=([^&]*)"))) ? l[1] : null;
            };
            g && c(g, "state") && (i = JSON.parse(decodeURIComponent(c(g, "state"))), "mpeditor" === i.action && (b.sessionStorage.setItem("_mpcehash", g), history.replaceState(i.desiredHash || "", e.title, j.pathname + j.search)));
        } catch (m) {}
        var k, h;
        window.mixpanel = a;
        a._i = [];
        a.init = function (b, c, f) {
            function e(b, a) {
            var c = a.split(".");
            2 == c.length && (b = b[c[0]], a = c[1]);
            b[a] = function () {
                b.push([a].concat(Array.prototype.slice.call(arguments, 0)));
            };
            }
            var d = a;
            "undefined" !== typeof f ? d = a[f] = [] : f = "mixpanel";
            d.people = d.people || [];
            d.toString = function (b) {
            var a = "mixpanel";
            "mixpanel" !== f && (a += "." + f);
            b || (a += " (stub)");
            return a;
            };
            d.people.toString = function () {
            return d.toString(1) + ".people (stub)";
            };
            k = "disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
            for (h = 0; h < k.length; h++) e(d, k[h]);
            a._i.push([b, c, f]);
        };
        a.__SV = 1.2;
        b = e.createElement("script");
        b.type = "text/javascript";
        b.async = !0;
        b.src = "undefined" !== typeof MIXPANEL_CUSTOM_LIB_URL
            ? MIXPANEL_CUSTOM_LIB_URL
            : "file:" === e.location.protocol && "//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)
            ? "https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js"
            : "//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";
        c = e.getElementsByTagName("script")[0];
        c.parentNode.insertBefore(b, c);
        }
    })(document, window.mixpanel || []);
    mixpanel.init("6fa5905b9195c203cb2dde06935627eb");

    {% if user %}
        var userId = "{{ user.id }}";
        var userEmail = "{{ user.email }}";
        var userName = "{{ user.name }}";
        var isPremium = "{{ user.is_premium }}" === 'True'; // Convert to Boolean
        // Identify the user
        mixpanel.identify(userId);
        mixpanel.people.set({
        "$email": "{{ user.email }}",
        "$name": "{{ user.name }}",
        "$isPremium": isPremium
        // Add other properties if needed
        });
    {% endif %}
    </script>

    {% block head %}{% endblock %}
</head>
<body>
    {% block navbar %}
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="{{ url_for('index') }}">ðŸ”® MBTI Oracle</a>
        <button class="navbar-toggler" type="button" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <!-- Keep the navbar-nav here for desktop view -->
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav ml-auto d-none d-lg-flex">
                <!-- Desktop nav items -->
                <li class="nav-item{% if request.endpoint == 'index' %} active{% endif %}">
                    <a class="nav-link" href="{{ url_for('index') }}">Interpreter</a>
                </li>
                <li class="nav-item{% if request.endpoint == 'translator' %} active{% endif %}">
                    <a class="nav-link" href="{{ url_for('translator') }}">Translator</a>
                </li>
                <li class="nav-item{% if request.endpoint == 'guesser' %} active{% endif %}">
                    <a class="nav-link" href="{{ url_for('guesser') }}">Guesser</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="desktopPremiumDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <strong>Premium</strong>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="desktopPremiumDropdown">
                        {% if not user.is_premium %}
                            <a class="dropdown-item" href="{{ url_for('upgrade') }}">Get Premium</a>
                            <div class="dropdown-divider"></div>
                        {% endif %}
                        <a class="dropdown-item" href="{{ url_for('adaptive_test') }}">MBTI Psychologist</a>
                        <a class="dropdown-item" href="{{ url_for('combined_report') }}">Combined Report</a>
                        <a class="dropdown-item" href="{{ url_for('vision') }}">Image Guesser</a>
                    </div>
                </li>
                <!-- Other desktop nav items -->
                <!-- User Menu (Desktop) -->
                {% if session.get('profile') %}
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="desktopProfileDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Menu
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="desktopProfileDropdown">
                        {% if not user.is_premium %}
                            <a class="dropdown-item" href="{{ url_for('purchase_insights') }}">Insights: {{ user.insights }}</a>
                            <div class="dropdown-divider"></div>
                        {% endif %}
                        <a class="dropdown-item" href="{{ url_for('profile') }}">Profile</a>
                        <a class="dropdown-item" href="{{ url_for('logout') }}">Logout</a>
                    </div>
                </li>
                {% else %}
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('login') }}">Login</a>
                </li>
                {% endif %}
            </ul>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-content">
            <!-- Mobile nav items -->
            <ul class="navbar-nav">
                <li class="nav-item{% if request.endpoint == 'index' %} active{% endif %}">
                    <a class="nav-link" href="{{ url_for('index') }}">Interpreter</a>
                </li>
                <li class="nav-item{% if request.endpoint == 'translator' %} active{% endif %}">
                    <a class="nav-link" href="{{ url_for('translator') }}">Translator</a>
                </li>
                <li class="nav-item{% if request.endpoint == 'guesser' %} active{% endif %}">
                    <a class="nav-link" href="{{ url_for('guesser') }}">Guesser</a>
                </li>
                <!-- Premium Dropdown -->
                <li class="nav-item">
                    <a class="nav-link dropdown-toggle" href="#" id="premiumDropdown" role="button">
                        <strong>Premium</strong>
                    </a>
                    <div class="dropdown-menu" aria-labelledby="premiumDropdown">
                        {% if not user.is_premium %}
                            <a class="dropdown-item" href="{{ url_for('upgrade') }}">Get Premium</a>
                            <div class="dropdown-divider"></div>
                        {% endif %}
                        <a class="dropdown-item" href="{{ url_for('adaptive_test') }}">MBTI Psychologist</a>
                        <a class="dropdown-item" href="{{ url_for('combined_report') }}">Combined Report</a>
                        <a class="dropdown-item" href="{{ url_for('vision') }}">Image Guesser</a>
                    </div>
                </li>
                <!-- User Menu -->
                {% if session.get('profile') %}
                <li class="nav-item">
                    <a class="nav-link dropdown-toggle" href="#" id="profileDropdown" role="button">
                        Menu
                    </a>
                    <div class="dropdown-menu" aria-labelledby="profileDropdown">
                        {% if not user.is_premium %}
                            <a class="dropdown-item" href="{{ url_for('purchase_insights') }}">Insights: {{ user.insights }}</a>
                            <div class="dropdown-divider"></div>
                        {% endif %}
                        <a class="dropdown-item" href="{{ url_for('profile') }}">Profile</a>
                        <a class="dropdown-item" href="{{ url_for('logout') }}">Logout</a>
                    </div>
                </li>
                {% else %}
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('login') }}">Login</a>
                </li>
                {% endif %}
            </ul>
        </div>
    </div>

    <!-- Backdrop -->
    <div class="mobile-menu-backdrop" id="mobileMenuBackdrop"></div>
    {% endblock %}
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            </div>
        {% endfor %}
    {% endif %}
    {% endwith %}
    
    {% block content %}{% endblock %}

    <footer class="footer py-3 bg-light">
        <div class="footer-container text-center">
            <span class="text-muted">
                &copy; {{ current_year }} MBTI Oracle. All rights reserved.
                <div>
                <a href="{{ url_for('privacy_policy') }}">Privacy Policy</a> |
                <a href="{{ url_for('terms_of_service') }}">Terms of Service</a>
                </div>
            </span>
        </div>
    </footer>

    <!-- Announcement! -->
    <div class="modal fade" id="announcementModal" tabindex="-1" aria-labelledby="announcementModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header text-white" style="background: linear-gradient(90deg, #3c9cdf 0%, #79b1da 100%);">
                    <h5 class="modal-title mx-auto d-flex align-items-center" id="announcementModalLabel">
                        
                        <span>Unlock Premium Features</span>
                    </h5>
                    <button type="button" class="close text-white position-absolute" style="right: 15px;" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <!-- Modal Body -->
                <div class="modal-body p-3">
                    <!-- Benefits Section -->
                    <div class="container-fluid">
                        <div class="row">
                            <!-- Benefit 1 -->
                            <div class="col-12 col-md-4 mb-3">
                                <div class="card border-0 h-100">
                                    <div class="card-body text-center p-2">
                                        <img src="{{ url_for('static', filename='mbti_psychologist.png') }}" alt="MBTI Psychologist" class="mb-2" style="height: 80px;">
                                        <h6 class="card-title font-weight-bold">MBTI Psychologist</h6>
                                        <p class="card-text small">Uncover deep insights about your personality through interactive sessions tailored just for you.</p>
                                    </div>
                                </div>
                            </div>
                            <!-- Benefit 2 -->
                            <div class="col-12 col-md-4 mb-3">
                                <div class="card border-0 h-100">
                                    <div class="card-body text-center p-2">
                                        <img src="{{ url_for('static', filename='combined_report.png') }}" alt="Combined Report" class="mb-2" style="height: 80px;">
                                        <h6 class="card-title font-weight-bold">Combined Report</h6>
                                        <p class="card-text small">Comprehensive analyses combined into one holistic report for deeper insights.</p>
                                    </div>
                                </div>
                            </div>
                            <!-- Benefit 3 -->
                            <div class="col-12 col-md-4 mb-3">
                                <div class="card border-0 h-100">
                                    <div class="card-body text-center p-2">
                                        <img src="{{ url_for('static', filename='unlock.svg') }}" alt="Unlimited Insights" class="mb-2" style="height: 80px;">
                                        <h6 class="card-title font-weight-bold">Unlimited Insights</h6>
                                        <p class="card-text small">Unlimited access to all premium features, including the Image Guesser.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Call-to-Action Button -->
                    <div class="text-center mt-2">
                        <a href="{{ url_for('upgrade') }}" class="btn btn-primary btn-lg btn-block">Upgrade Now</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Include JavaScript files -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!--<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>-->

    <script type="text/javascript">
        document.addEventListener("DOMContentLoaded", function() {
            mixpanel.track("Page Viewed", {
              "Page": "{{ request.page_title }}",
              "URL": "{{ request.path }}",
              "User ID": userId || "Anonymous",
              "Premium": isPremium
            });
        });
        
    </script>
    <script>
        $(document).ready(function() {
            // Open the mobile menu
            $('.navbar-toggler').on('click', function() {
                $('#mobileMenu').addClass('show');
                $('#mobileMenuBackdrop').addClass('show');
            });

            // Close the mobile menu when clicking the backdrop
            $('#mobileMenuBackdrop').on('click', function() {
                $('#mobileMenu').removeClass('show');
                $(this).removeClass('show');
            });

            // Toggle dropdown menus in the mobile menu
            $('#mobileMenu .dropdown-toggle').on('click', function(e) {
                e.preventDefault();
                e.stopPropagation(); // Prevent event bubbling

                // Close any other open dropdown menus
                $('#mobileMenu .dropdown-menu.show').not($(this).siblings('.dropdown-menu')).removeClass('show');

                // Toggle the clicked dropdown menu
                $(this).siblings('.dropdown-menu').toggleClass('show');
            });

            // Close the mobile menu when clicking a link that is not a dropdown toggle
            $('#mobileMenu .nav-link').on('click', function(e) {
                if (!$(this).hasClass('dropdown-toggle')) {
                    $('#mobileMenu').removeClass('show');
                    $('#mobileMenuBackdrop').removeClass('show');
                }
            });
        });
    </script>

    <!-- Place this script after including jQuery and Bootstrap JS in your base.html -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Use a unique key for the announcement
            const announcementKey = 'announce_14'; // Increment the version if needed
    
            // Get the current URL path
            var path = window.location.pathname;
    
            // Check if the user has already seen the popup and we're not on the upgrade page
            if (!localStorage.getItem(announcementKey) && !path.includes('/upgrade')) {
                // Show the modal
                $('#announcementModal').modal('show');
    
                // Set the flag in localStorage immediately
                localStorage.setItem(announcementKey, 'true');
            }
        });
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>
